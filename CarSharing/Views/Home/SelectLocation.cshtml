@model IEnumerable<CarSharing.car>

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <!--<meta name="viewport" content="width=device-width" />-->
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Simple markers</title>
    <style>
        html, body {
            height: 100%;
            margin: 0px;
            padding: 0px;
        }

        #map-canvas {
            height: 70%;
            width: 50%;
        }

        #panel {
            position: absolute;
            top: 5px;
            left: 50%;
            margin-left: -180px;
            z-index: 5;
            background-color: #fff;
            padding: 5px;
            border: 1px solid #999;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>
        var geocoder;
        var map;

        // array with car-information
        var cars = [
            @for (var i = 0; i < Model.Count(); i++ )
            {
                var item = Model.ElementAt(i);
                if (item.parking_pos != null)
                {
                    @Html.Raw("            ['");
                    @Html.Raw(item.name);
                    @Html.Raw("', ");
                    @Html.Raw(item.parking_pos);
                    @Html.Raw(", ");
                    @Html.Raw(i);
                    if (i == (Model.Count()-1))
                        { @Html.Raw("]\r\n"); }
                    else
                        { @Html.Raw("],\r\n"); }
                }
            }
        ];

        function initialize() {
            geocoder = new google.maps.Geocoder();
            var latlng = new google.maps.LatLng(51.000, 10.500);
            var mapOptions = {
                zoom: 6,
                center: latlng
            }
            map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

            setMarkers(map, cars);

            @if (!String.IsNullOrEmpty(ViewBag.searchStr))
            {
                @Html.Raw("            codeAdress();\r\n");
            }
        }

        function setMarkers(map, locations) {
            for (var i = 0; i < locations.length; i++) {
                var location = locations[i];
                var myLatLng = new google.maps.LatLng(location[1], location[2]);
                var marker = new google.maps.Marker({
                    position: myLatLng,
                    map: map,
                    //icon: image,
                    //shape: shape,
                    title: location[0],
                    zIndex: location[3]
                });
            }
        }

        function codeAddress() {
            var searchFlag = '../../Images/searchFlag.png';
            var address = document.getElementById('address').value;
            geocoder.geocode({ 'address': address }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    map.setCenter(results[0].geometry.location);
                    map.setZoom(12);
                    var marker = new google.maps.Marker({
                        map: map,
                        position: results[0].geometry.location,
                        title: 'your Search',
                        icon: searchFlag
                    });
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }

        google.maps.event.addDomListener(window, 'load', initialize);

    </script>
</head>
<body>
    <div>
        <input id="address" type="textbox" value="@ViewBag.searchStr">
        <input type="button" value="Search" onclick="codeAddress()">
    </div>
    <div id="map-canvas"></div>
</body>
</html>
